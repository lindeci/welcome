- [执行的SQL](#执行的sql)
- [断点位置](#断点位置)
- [设置格式](#设置格式)
- [查看 PT\_create\_table\_stmt 的内容](#查看-pt_create_table_stmt-的内容)
- [查看 ID 字段的对象内容](#查看-id-字段的对象内容)
  - [PT\_auto\_increment\_column\_attr](#pt_auto_increment_column_attr)
  - [PT\_primary\_key\_column\_attr](#pt_primary_key_column_attr)
  - [PT\_comment\_column\_attr](#pt_comment_column_attr)
- [PT\_column\_def 操作分析](#pt_column_def-操作分析)
  - [contextualize 分析](#contextualize-分析)
    - [断点位置](#断点位置-1)
    - [模板的参数类型](#模板的参数类型)
    - [对象内容](#对象内容)
  - [do\_contextualize 分析](#do_contextualize-分析)
    - [断点位置](#断点位置-2)
    - [对应代码](#对应代码)
  - [PT\_column\_def 对象内容](#pt_column_def-对象内容)
  - [PT\_field\_def 操作分析](#pt_field_def-操作分析)
    - [断点位置](#断点位置-3)
    - [对应代码](#对应代码-1)
    - [do\_contextualize 操作分析](#do_contextualize-操作分析)
    - [对应代码](#对应代码-2)
    - [PT\_field\_def 对象内容](#pt_field_def-对象内容)
      - [PT\_column\_attr\_base 分析](#pt_column_attr_base-分析)
        - [对象内容](#对象内容-1)
        - [查看动态数组中的对象类型](#查看动态数组中的对象类型)
      - [函数成员 contextualize\_attrs 操作分析](#函数成员-contextualize_attrs-操作分析)
- [返回 PT\_create\_table\_stmt 继续跟踪](#返回-pt_create_table_stmt-继续跟踪)
  - [查看 opt\_create\_table\_options](#查看-opt_create_table_options)
  - [函数末尾查看 Table\_ddl\_parse\_context pc2](#函数末尾查看-table_ddl_parse_context-pc2)
    - [查看 create\_info](#查看-create_info)
    - [查看 alter\_info](#查看-alter_info)
    - [查看 key\_create\_info](#查看-key_create_info)
    - [查看 alter\_info-\>key\_list](#查看-alter_info-key_list)
      - [查看 alter\_info-\>key\_list-\>m\_array\[0\]](#查看-alter_info-key_list-m_array0)
      - [查看 alter\_info-\>key\_list-\>m\_array\[1\]](#查看-alter_info-key_list-m_array1)
    - [查看 alter\_info-\>create\_list](#查看-alter_info-create_list)
      - [begin](#begin)
      - [begin.next](#beginnext)
      - [begin.next.next](#beginnextnext)
- [pc2 跟 PT\_create\_table\_stmt、thd-\>lex 关系](#pc2-跟-pt_create_table_stmtthd-lex-关系)
- [返回的 Sql\_cmd\_create\_table 查看](#返回的-sql_cmd_create_table-查看)
  - [断点位置](#断点位置-4)
  - [对象内容](#对象内容-2)
  - [查看  m\_alter\_info](#查看--m_alter_info)
- [执行 SQL 跟踪](#执行-sql-跟踪)
  - [mysql\_execute\_command](#mysql_execute_command)
  - [mysql\_execute\_command 函数内部](#mysql_execute_command-函数内部)
  - [回到 Sql\_cmd\_create\_table](#回到-sql_cmd_create_table)
  - [继续跟踪 mysql\_create\_table](#继续跟踪-mysql_create_table)

# 执行的SQL
```sql
CREATE TABLE user (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '唯一ID',
    name VARCHAR(255) NOT NULL COMMENT '姓名',
    salary DECIMAL(10, 2) COMMENT '薪资',
    birth_date DATE COMMENT '生日',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    is_active BOOLEAN COMMENT '是否活跃',
    description TEXT COMMENT '描述',
    status ENUM('active', 'inactive') COMMENT '状态',
    binary_data BLOB COMMENT '头像',
    ip_address VARCHAR(15) COMMENT 'IP 地址',
    email VARCHAR(255) COMMENT '邮件',
    website_url VARCHAR(255) COMMENT '个人网址',
    index idx_1(name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
```

# 断点位置
```cpp
PT_create_table_stmt::make_cmd(PT_create_table_stmt * const this, THD * thd) (\data\mysql-server-8.2.0\sql\parse_tree_nodes.cc:2331)
LEX::make_sql_cmd(LEX * const this, Parse_tree_root * parse_tree) (\data\mysql-server-8.2.0\sql\sql_lex.cc:5040)
THD::sql_parser(THD * const this) (\data\mysql-server-8.2.0\sql\sql_class.cc:3084)
parse_sql(THD * thd, Parser_state * parser_state, Object_creation_ctx * creation_ctx) (\data\mysql-server-8.2.0\sql\sql_parse.cc:7290)
dispatch_sql_command(THD * thd, Parser_state * parser_state) (\data\mysql-server-8.2.0\sql\sql_parse.cc:5421)
dispatch_command(THD * thd, const COM_DATA * com_data, enum_server_command command) (\data\mysql-server-8.2.0\sql\sql_parse.cc:2137)
do_command(THD * thd) (\data\mysql-server-8.2.0\sql\sql_parse.cc:1466)
handle_connection(void * arg) (\data\mysql-server-8.2.0\sql\conn_handler\connection_handler_per_thread.cc:303)
```
# 设置格式
```sh
-exec set object = on
-exec set print pretty on
```

# 查看 PT_create_table_stmt 的内容
```json
-exec p *this
$62 = {
  <PT_table_ddl_stmt_base> = {
    <Parse_tree_root> = {
      _vptr.Parse_tree_root = 0x5624cdd3ab88 <vtable for PT_create_table_stmt+16>,
      m_pos = {
        cpp = {
          start = 0x7f236c18c2b0 "CREATE TABLE user (\n\t    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMME"...,
          end = 0x7f236c18c56c ""
        },
        raw = {
          start = 0x7f236c18bff0 "CREATE TABLE user (\n\t    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMME"...,
          end = 0x7f236c18c2ac ""
        }
      }
    }, 
    members of PT_table_ddl_stmt_base:
    m_alter_info = {
      drop_list = {
        <Mem_root_array_YY<Alter_drop const*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      alter_list = {
        <Mem_root_array_YY<Alter_column const*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      key_list = {
        <Mem_root_array_YY<Key_spec*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      alter_rename_key_list = {
        <Mem_root_array_YY<Alter_rename_key const*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      alter_index_visibility_list = {
        <Mem_root_array_YY<Alter_index_visibility const*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      alter_constraint_enforcement_list = {
        <Mem_root_array_YY<Alter_constraint_enforcement const*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      check_constraint_spec_list = {
        <Mem_root_array_YY<Sql_check_constraint_spec*>> = {
          m_root = 0x7f236c1088b0,
          m_array = 0x0,
          m_size = 0,
          m_capacity = 0
        }, <No data fields>},
      create_list = {
        <base_list> = {
          first = 0x5624ce192e30 <end_of_list>,
          last = 0x7f236c001dc8,
          elements = 0
        }, <No data fields>},
      cf_appliers = std::vector of length 0, capacity 0,
      flags = 0,
      keys_onoff = Alter_info::LEAVE_AS_IS,
      partition_names = {
        <base_list> = {
          first = 0x5624ce192e30 <end_of_list>,
          last = 0x7f236c001e08,
          elements = 0
        }, <No data fields>},
      num_parts = 0,
      requested_algorithm = Alter_info::ALTER_TABLE_ALGORITHM_DEFAULT,
      requested_lock = Alter_info::ALTER_TABLE_LOCK_DEFAULT,
      with_validation = Alter_info::ALTER_VALIDATION_DEFAULT,
      new_db_name = {
        str = 0x0,
        length = 0
      },
      new_table_name = {
        str = 0x0,
        length = 0
      }
    }
  }, 
  members of PT_create_table_stmt:
  is_temporary = false,
  only_if_not_exists = false,
  table_name = 0x7f236c18c9f8,
  opt_table_element_list = 0x7f236c18cd30,
  opt_create_table_options = 0x7f236c001b38,
  opt_partitioning = 0x0,
  on_duplicate = On_duplicate::ERROR,
  opt_query_expression = 0x0,
  opt_like_clause = 0x0,
  m_create_info = {
    table_charset = 0x0,
    default_table_charset = 0x0,
    schema_read_only = false,
    connect_string = {
      str = 0x0,
      length = 0
    },
    password = 0x0,
    tablespace = 0x0,
    comment = {
      str = 0x0,
      length = 0
    },
    compress = {
      str = 0x0,
      length = 0
    },
    encrypt_type = {
      str = 0x0,
      length = 0
    },
    secondary_engine = {
      str = 0x0,
      length = 0
    },
    secondary_load = false,
    data_file_name = 0x0,
    index_file_name = 0x0,
    alias = 0x0,
    max_rows = 0,
    min_rows = 0,
    auto_increment_value = 0,
    table_options = 0,
    avg_row_length = 0,
    used_fields = 0,
    key_block_size = 0,
    stats_sample_pages = 0,
    stats_auto_recalc = HA_STATS_AUTO_RECALC_DEFAULT,
    merge_list = {
      elements = 0,
      first = 0x0,
      next = 0x7f236c001f70
    },
    db_type = 0x0,
    row_type = ROW_TYPE_DEFAULT,
    null_bits = 0,
    options = 0,
    merge_insert_method = 0,
    storage_media = HA_SM_DEFAULT,
    m_hidden = false,
    m_transactional_ddl = false,
    engine_attribute = {
      str = 0x0,
      length = 0
    },
    secondary_engine_attribute = {
      str = 0x0,
      length = 0
    },
    m_implicit_tablespace_autoextend_size = 0,
    m_implicit_tablespace_autoextend_size_change = true
  }
}
```

# 查看 ID 字段的对象内容
## PT_auto_increment_column_attr
```json
-exec p typeid(*(((PT_field_def*)(((PT_column_def*)((*opt_table_element_list)->m_array[0]))->field_def))->opt_attrs->m_array[0]))
$56 = {
  _vptr.type_info = 0x7f2433e07c30 <vtable for __cxxabiv1::__si_class_type_info+16>,
  __name = 0x5624cbb4c5e0 <typeinfo name for PT_auto_increment_column_attr> "29PT_auto_increment_column_attr"
}
-exec p *(PT_auto_increment_column_attr*)((((PT_field_def*)(((PT_column_def*)((*opt_table_element_list)->m_array[0]))->field_def))->opt_attrs->m_array[0]))
$57 = {
  <PT_column_attr_base> = {
    <Parse_tree_node_tmpl<Column_parse_context>> = {
      _vptr.Parse_tree_node_tmpl = 0x5624cdc61ed8 <vtable for PT_auto_increment_column_attr+16>,
      contextualized = false,
      m_pos = {
        cpp = {
          start = 0x7f236c18c2d0 "AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIM"...,
          end = 0x7f236c18c2de " PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT"...
        },
        raw = {
          start = 0x7f236c18c010 "AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIM"...,
          end = 0x7f236c18c01e " PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT"...
        }
      }
    }, <No data fields>}, <No data fields>}
```
## PT_primary_key_column_attr
```json
-exec p typeid(*(((PT_field_def*)(((PT_column_def*)((*opt_table_element_list)->m_array[0]))->field_def))->opt_attrs->m_array[1]))
$54 = {
  _vptr.type_info = 0x7f2433e07c30 <vtable for __cxxabiv1::__si_class_type_info+16>,
  __name = 0x5624cbb4c6f0 <typeinfo name for PT_primary_key_column_attr> "26PT_primary_key_column_attr"
}

-exec p *(PT_primary_key_column_attr*)((((PT_field_def*)(((PT_column_def*)((*opt_table_element_list)->m_array[0]))->field_def))->opt_attrs->m_array[1]))
$55 = {
  <PT_column_attr_base> = {
    <Parse_tree_node_tmpl<Column_parse_context>> = {
      _vptr.Parse_tree_node_tmpl = 0x5624cdc62300 <vtable for PT_primary_key_column_attr+16>,
      contextualized = false,
      m_pos = {
        cpp = {
          start = 0x7f236c18c2df "PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT "...,
          end = 0x7f236c18c2ea " COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIM"...
        },
        raw = {
          start = 0x7f236c18c01f "PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT "...,
          end = 0x7f236c18c02a " COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIM"...
        }
      }
    }, <No data fields>}, <No data fields>}
```
## PT_comment_column_attr
```json
-exec p typeid(*(((PT_field_def*)(((PT_column_def*)((*opt_table_element_list)->m_array[0]))->field_def))->opt_attrs->m_array[2]))
$58 = {
  _vptr.type_info = 0x7f2433e07c30 <vtable for __cxxabiv1::__si_class_type_info+16>,
  __name = 0x5624cbb4c660 <typeinfo name for PT_comment_column_attr> "22PT_comment_column_attr"
}
-exec p *(PT_comment_column_attr*)((((PT_field_def*)(((PT_column_def*)((*opt_table_element_list)->m_array[0]))->field_def))->opt_attrs->m_array[2]))
$59 = {
  <PT_column_attr_base> = {
    <Parse_tree_node_tmpl<Column_parse_context>> = {
      _vptr.Parse_tree_node_tmpl = 0x5624cdc62138 <vtable for PT_comment_column_attr+16>,
      contextualized = false,
      m_pos = {
        cpp = {
          start = 0x7f236c18c2eb "COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIME"...,
          end = 0x7f236c18c2fd ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
        },
        raw = {
          start = 0x7f236c18c02b "COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIME"...,
          end = 0x7f236c18c03d ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
        }
      }
    }, <No data fields>}, 
  members of PT_comment_column_attr:
  comment = {
    str = 0x7f236c18cbb8 "\345\224\257\344\270\200ID",
    length = 8
  }
}
```

# PT_column_def 操作分析
## contextualize 分析
### 断点位置
```cpp
Parse_tree_node_tmpl<Table_ddl_parse_context>::contextualize(Parse_tree_node_tmpl<Table_ddl_parse_context> * const this, Table_ddl_parse_context * pc) (\data\mysql-server-8.2.0\sql\parse_tree_node_base.h:320)
PT_create_table_stmt::make_cmd(PT_create_table_stmt * const this, THD * thd) (\data\mysql-server-8.2.0\sql\parse_tree_nodes.cc:2393)
LEX::make_sql_cmd(LEX * const this, Parse_tree_root * parse_tree) (\data\mysql-server-8.2.0\sql\sql_lex.cc:5040)
THD::sql_parser(THD * const this) (\data\mysql-server-8.2.0\sql\sql_class.cc:3084)
parse_sql(THD * thd, Parser_state * parser_state, Object_creation_ctx * creation_ctx) (\data\mysql-server-8.2.0\sql\sql_parse.cc:7290)
dispatch_sql_command(THD * thd, Parser_state * parser_state) (\data\mysql-server-8.2.0\sql\sql_parse.cc:5421)
dispatch_command(THD * thd, const COM_DATA * com_data, enum_server_command command) (\data\mysql-server-8.2.0\sql\sql_parse.cc:2137)
do_command(THD * thd) (\data\mysql-server-8.2.0\sql\sql_parse.cc:1466)
handle_connection(void * arg) (\data\mysql-server-8.2.0\sql\conn_handler\connection_handler_per_thread.cc:303)
pfs_spawn_thread(void * arg) (\data\mysql-server-8.2.0\storage\perfschema\pfs.cc:3049)
```
对应代码
```cpp
template <typename Context>
class Parse_tree_node_tmpl {
  ……
  virtual bool contextualize(Context *pc) final {
    // For condition#2 below ... If position is empty, this item was not
    // created in the parser; so don't show it in the parse tree.
    if (pc->m_show_parse_tree == nullptr || this->m_pos.is_empty())
      return do_contextualize(pc);

    Show_parse_tree *tree = pc->m_show_parse_tree.get();

    if (begin_parse_tree(tree)) return true;

    if (do_contextualize(pc)) return true;

    if (end_parse_tree(tree)) return true;

    return false;
  }
  ……
}
```
### 模板的参数类型
```cpp
Parse_tree_node_tmpl <Table_ddl_parse_context>::contextualize
```
### 对象内容
```cpp
-exec p *this
$64 = {
  _vptr.Parse_tree_node_tmpl = 0x5624cdd3abb8 <vtable for PT_column_def+16>,
  contextualized = false,
  m_pos = {
    cpp = {
      start = 0x7f236c18c2c9 "id INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created"...,
      end = 0x7f236c18c2fd ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
    },
    raw = {
      start = 0x7f236c18c009 "id INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created"...,
      end = 0x7f236c18c03d ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
    }
  }
}
```
## do_contextualize 分析
程序从 `Parse_tree_node_tmpl::contextualize` 中的 `do_contextualize` 进入了 `PT_column_def::do_contextualize`
### 断点位置
```cpp
PT_column_def::do_contextualize(PT_column_def * const this, Table_ddl_parse_context * pc) (\data\mysql-server-8.2.0\sql\parse_tree_nodes.cc:2300)
Parse_tree_node_tmpl<Table_ddl_parse_context>::contextualize(Parse_tree_node_tmpl<Table_ddl_parse_context> * const this, Table_ddl_parse_context * pc) (\data\mysql-server-8.2.0\sql\parse_tree_node_base.h:321)
PT_create_table_stmt::make_cmd(PT_create_table_stmt * const this, THD * thd) (\data\mysql-server-8.2.0\sql\parse_tree_nodes.cc:2393)
LEX::make_sql_cmd(LEX * const this, Parse_tree_root * parse_tree) (\data\mysql-server-8.2.0\sql\sql_lex.cc:5040)
THD::sql_parser(THD * const this) (\data\mysql-server-8.2.0\sql\sql_class.cc:3084)
parse_sql(THD * thd, Parser_state * parser_state, Object_creation_ctx * creation_ctx) (\data\mysql-server-8.2.0\sql\sql_parse.cc:7290)
dispatch_sql_command(THD * thd, Parser_state * parser_state) (\data\mysql-server-8.2.0\sql\sql_parse.cc:5421)
dispatch_command(THD * thd, const COM_DATA * com_data, enum_server_command command) (\data\mysql-server-8.2.0\sql\sql_parse.cc:2137)
do_command(THD * thd) (\data\mysql-server-8.2.0\sql\sql_parse.cc:1466)
handle_connection(void * arg) (\data\mysql-server-8.2.0\sql\conn_handler\connection_handler_per_thread.cc:303)
pfs_spawn_thread(void * arg) (\data\mysql-server-8.2.0\storage\perfschema\pfs.cc:3049)
libc.so.6!start_thread(void * arg) (pthread_create.c:442)
libc.so.6!clone() (clone.S:100)
```

### 对应代码
```cpp
bool PT_column_def::do_contextualize(Table_ddl_parse_context *pc) {
  // Since Alter_info objects are allocated on a mem_root and never
  // destroyed we (move)-assign an empty vector to cf_appliers to
  // ensure any dynamic memory is released. This must be done whenever
  // leaving this scope since appliers may be added in
  // field_def->contextualize(pc).
  auto clr_appliers = create_scope_guard([&]() {
    pc->alter_info->cf_appliers = decltype(pc->alter_info->cf_appliers)();
  });

  if (super::do_contextualize(pc) || field_def->contextualize(pc) ||
      contextualize_safe(pc, opt_column_constraint))
    return true;

  pc->alter_info->flags |= field_def->alter_info_flags;
  dd::Column::enum_hidden_type field_hidden_type =
      (field_def->type_flags & FIELD_IS_INVISIBLE)
          ? dd::Column::enum_hidden_type::HT_HIDDEN_USER
          : dd::Column::enum_hidden_type::HT_VISIBLE;

  return pc->alter_info->add_field(
      pc->thd, &field_ident, field_def->type, field_def->length, field_def->dec,
      field_def->type_flags, field_def->default_value,
      field_def->on_update_value, &field_def->comment, nullptr,
      field_def->interval_list, field_def->charset,
      field_def->has_explicit_collation, field_def->uint_geom_type,
      field_def->gcol_info, field_def->default_val_info, opt_place,
      field_def->m_srid, field_def->check_const_spec_list, field_hidden_type);
}
```
## PT_column_def 对象内容
```cpp
-exec p *this
$65 = {
  <PT_table_element> = {
    <Parse_tree_node_tmpl<Table_ddl_parse_context>> = {
      _vptr.Parse_tree_node_tmpl = 0x5624cdd3abb8 <vtable for PT_column_def+16>,
      contextualized = false,
      m_pos = {
        cpp = {
          start = 0x7f236c18c2c9 "id INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created"...,
          end = 0x7f236c18c2fd ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
        },
        raw = {
          start = 0x7f236c18c009 "id INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created"...,
          end = 0x7f236c18c03d ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
        }
      }
    }, <No data fields>}, 
  members of PT_column_def:
  field_ident = {
    str = 0x7f236c18ca30 "id",
    length = 2
  },
  field_def = 0x7f236c18cc18,
  opt_column_constraint = 0x0,
  opt_place = 0x0
}
```
## PT_field_def 操作分析
### 断点位置
```cpp
Parse_tree_node_tmpl<Parse_context>::contextualize(Parse_tree_node_tmpl<Parse_context> * const this, Parse_context * pc) (\data\mysql-server-8.2.0\sql\parse_tree_node_base.h:320)
PT_column_def::do_contextualize(PT_column_def * const this, Table_ddl_parse_context * pc) (\data\mysql-server-8.2.0\sql\parse_tree_nodes.cc:2310)
Parse_tree_node_tmpl<Table_ddl_parse_context>::contextualize(Parse_tree_node_tmpl<Table_ddl_parse_context> * const this, Table_ddl_parse_context * pc) (\data\mysql-server-8.2.0\sql\parse_tree_node_base.h:321)
PT_create_table_stmt::make_cmd(PT_create_table_stmt * const this, THD * thd) (\data\mysql-server-8.2.0\sql\parse_tree_nodes.cc:2393)
LEX::make_sql_cmd(LEX * const this, Parse_tree_root * parse_tree) (\data\mysql-server-8.2.0\sql\sql_lex.cc:5040)
THD::sql_parser(THD * const this) (\data\mysql-server-8.2.0\sql\sql_class.cc:3084)
parse_sql(THD * thd, Parser_state * parser_state, Object_creation_ctx * creation_ctx) (\data\mysql-server-8.2.0\sql\sql_parse.cc:7290)
dispatch_sql_command(THD * thd, Parser_state * parser_state) (\data\mysql-server-8.2.0\sql\sql_parse.cc:5421)
dispatch_command(THD * thd, const COM_DATA * com_data, enum_server_command command) (\data\mysql-server-8.2.0\sql\sql_parse.cc:2137)
do_command(THD * thd) (\data\mysql-server-8.2.0\sql\sql_parse.cc:1466)
handle_connection(void * arg) (\data\mysql-server-8.2.0\sql\conn_handler\connection_handler_per_thread.cc:303)
pfs_spawn_thread(void * arg) (\data\mysql-server-8.2.0\storage\perfschema\pfs.cc:3049)
libc.so.6!start_thread(void * arg) (pthread_create.c:442)
libc.so.6!clone() (clone.S:100)
```
### 对应代码
```cpp
bool PT_column_def::do_contextualize(Table_ddl_parse_context *pc) {
  // Since Alter_info objects are allocated on a mem_root and never
  // destroyed we (move)-assign an empty vector to cf_appliers to
  // ensure any dynamic memory is released. This must be done whenever
  // leaving this scope since appliers may be added in
  // field_def->contextualize(pc).
  auto clr_appliers = create_scope_guard([&]() {
    pc->alter_info->cf_appliers = decltype(pc->alter_info->cf_appliers)();
  });

  if (super::do_contextualize(pc) || field_def->contextualize(pc) ||
      contextualize_safe(pc, opt_column_constraint))
    return true;

  pc->alter_info->flags |= field_def->alter_info_flags;
  dd::Column::enum_hidden_type field_hidden_type =
      (field_def->type_flags & FIELD_IS_INVISIBLE)
          ? dd::Column::enum_hidden_type::HT_HIDDEN_USER
          : dd::Column::enum_hidden_type::HT_VISIBLE;

  return pc->alter_info->add_field(
      pc->thd, &field_ident, field_def->type, field_def->length, field_def->dec,
      field_def->type_flags, field_def->default_value,
      field_def->on_update_value, &field_def->comment, nullptr,
      field_def->interval_list, field_def->charset,
      field_def->has_explicit_collation, field_def->uint_geom_type,
      field_def->gcol_info, field_def->default_val_info, opt_place,
      field_def->m_srid, field_def->check_const_spec_list, field_hidden_type);
}
```
### do_contextualize 操作分析
程序从 `Parse_tree_node_tmpl::contextualize` 中的 `do_contextualize` 进入了 `PT_field_def::do_contextualize`
### 对应代码
```cpp
  bool do_contextualize(Parse_context *pc_arg) override {
    Column_parse_context pc(pc_arg->thd, pc_arg->select, false);
    if (super::do_contextualize(&pc) || contextualize_attrs(&pc, opt_attrs))
      return true;

    move_cf_appliers(pc_arg, &pc);
    return false;
  }
```
### PT_field_def 对象内容
```cpp
-exec p *this
$71 = {
  <PT_field_def_base> = {
    <Parse_tree_node_tmpl<Parse_context>> = {
      _vptr.Parse_tree_node_tmpl = 0x5624cdc61528 <vtable for PT_field_def+16>,
      contextualized = false,
      m_pos = {
        cpp = {
          start = 0x7f236c18c2cc "INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at"...,
          end = 0x7f236c18c2fd ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
        },
        raw = {
          start = 0x7f236c18c00c "INT AUTO_INCREMENT PRIMARY KEY COMMENT '\345\224\257\344\270\200ID',\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at"...,
          end = 0x7f236c18c03d ",\n\t    name VARCHAR(255) NOT NULL COMMENT '\345\247\223\345\220\215',\n\t    salary DECIMAL(10, 2) COMMENT '\350\226\252\350\265\204',\n\t    birth_date DATE COMMENT '\347\224\237\346\227\245',\n\t    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '\345\210\233"...
        }
      }
    }, 
    members of PT_field_def_base:
    type = MYSQL_TYPE_INVALID,
    type_flags = 0,
    length = 0x0,
    dec = 0x0,
    charset = 0x0,
    has_explicit_collation = false,
    uint_geom_type = 0,
    interval_list = 0x0,
    alter_info_flags = 0,
    comment = {
      str = 0x5624cbaceef0 "",
      length = 0
    },
    default_value = 0x0,
    on_update_value = 0x0,
    gcol_info = 0x0,
    default_val_info = 0x0,
    m_srid = std::optional<unsigned int> [no contained value],
    check_const_spec_list = 0x0,
    type_node = 0x7f236c18ca38
  }, 
  members of PT_field_def:
  opt_attrs = 0x7f236c18cab8
}
```
#### PT_column_attr_base 分析
##### 对象内容
```cpp
-exec p *opt_attrs
$72 = {
  <Mem_root_array_YY<PT_column_attr_base*>> = {
    m_root = 0x7f236c1088b0,
    m_array = 0x7f236c18cad8,
    m_size = 3,
    m_capacity = 20
  }, <No data fields>}
```
##### 查看动态数组中的对象类型
```cpp
-exec p typeid(*opt_attrs->m_array[0])
$84 = {
  _vptr.type_info = 0x7f2433e07c30 <vtable for __cxxabiv1::__si_class_type_info+16>,
  __name = 0x5624cbb4c5e0 <typeinfo name for PT_auto_increment_column_attr> "29PT_auto_increment_column_attr"
}
```
```cpp
-exec p typeid(*opt_attrs->m_array[1])
$85 = {
  _vptr.type_info = 0x7f2433e07c30 <vtable for __cxxabiv1::__si_class_type_info+16>,
  __name = 0x5624cbb4c6f0 <typeinfo name for PT_primary_key_column_attr> "26PT_primary_key_column_attr"
}
```
```cpp
-exec p typeid(*opt_attrs->m_array[2])
$86 = {
  _vptr.type_info = 0x7f2433e07c30 <vtable for __cxxabiv1::__si_class_type_info+16>,
  __name = 0x5624cbb4c660 <typeinfo name for PT_comment_column_attr> "22PT_comment_column_attr"
}
```
#### 函数成员 contextualize_attrs 操作分析
```cpp
  template <class T>
  bool contextualize_attrs(Column_parse_context *pc,
                           Mem_root_array<T *> *attrs) {
    if (attrs != nullptr) {
      for (auto attr : *attrs) {
        if (attr->contextualize(pc)) return true;
        attr->apply_type_flags(&type_flags);
        attr->apply_alter_info_flags(&alter_info_flags);
        attr->apply_comment(&comment);
        attr->apply_default_value(&default_value);
        attr->apply_gen_default_value(&default_val_info);
        attr->apply_on_update_value(&on_update_value);
        attr->apply_srid_modifier(&m_srid);
        if (attr->apply_collation(pc, &charset, &has_explicit_collation))
          return true;
        if (attr->add_check_constraints(check_const_spec_list)) return true;
      }
    }
    return false;
  }
```
主要是对 PT_field_def_base 下面的部分变量进行初始化
```cpp
  enum_field_types type = MYSQL_TYPE_INVALID;
  ulong type_flags = 0;
  const char *length = nullptr;
  const char *dec = nullptr;
  const CHARSET_INFO *charset = nullptr;
  bool has_explicit_collation = false;
  uint uint_geom_type = 0;
  List<String> *interval_list = nullptr;
  alter_info_flags_t alter_info_flags = 0;
  LEX_CSTRING comment = EMPTY_CSTR;
  Item *default_value = nullptr;
  Item *on_update_value = nullptr;
  Value_generator *gcol_info = nullptr;
  /// Holds the expression to generate default values
  Value_generator *default_val_info = nullptr;
  std::optional<gis::srid_t> m_srid{};
  // List of column check constraint's specification.
  Sql_check_constraint_spec_list *check_const_spec_list = nullptr;
```

# 返回 PT_create_table_stmt 继续跟踪
## 查看 opt_create_table_options
```cpp
-exec p typeid(*opt_create_table_options->m_array[0]).__name
$107 = 0x5624cbc250a0 <typeinfo name for PT_create_table_engine_option> "29PT_create_table_engine_option"

-exec p typeid(*opt_create_table_options->m_array[1]).__name
$108 = 0x5624cbc24fa0 <typeinfo name for PT_create_table_default_charset> "31PT_create_table_default_charset"

-exec p typeid(*opt_create_table_options->m_array[2]).__name
$109 = 0x5624cbc24f60 <typeinfo name for PT_create_table_default_collation> "33PT_create_table_default_collation"
```
## 函数末尾查看 Table_ddl_parse_context pc2
```json
-exec p pc2
$112 = {
  <Parse_context> = {
    <Parse_context_base> = {
      m_show_parse_tree = std::unique_ptr<Show_parse_tree> = {
        get() = 0x0
      }
    }, 
    members of Parse_context:
    thd = 0x7f236c105ee0,
    mem_root = 0x7f236c1088b0,
    select = 0x7f236c18c658,
    m_stack = {
      m_blocks = 0x7f236c002a50,
      m_begin_idx = 8,
      m_end_idx = 9,
      m_capacity = 16,
      m_root = 0x7f236c1088b0,
      m_generation = 1
    }
  }, 
  members of Table_ddl_parse_context:
  create_info = 0x7f236c001e90,
  alter_info = 0x7f236c001ce8,
  key_create_info = 0x7f236c01b200
}
```
### 查看 create_info
```json
-exec p *pc2.create_info
$115 = {
  table_charset = 0x0,
  default_table_charset = 0x5624cdf92080 <my_charset_utf8mb4_bin>,
  schema_read_only = false,
  connect_string = {
    str = 0x0,
    length = 0
  },
  password = 0x0,
  tablespace = 0x0,
  comment = {
    str = 0x0,
    length = 0
  },
  compress = {
    str = 0x0,
    length = 0
  },
  encrypt_type = {
    str = 0x0,
    length = 0
  },
  secondary_engine = {
    str = 0x0,
    length = 0
  },
  secondary_load = false,
  data_file_name = 0x0,
  index_file_name = 0x0,
  alias = 0x0,
  max_rows = 0,
  min_rows = 0,
  auto_increment_value = 0,
  table_options = 0,
  avg_row_length = 0,
  used_fields = 268440064,
  key_block_size = 0,
  stats_sample_pages = 0,
  stats_auto_recalc = HA_STATS_AUTO_RECALC_DEFAULT,
  merge_list = {
    elements = 0,
    first = 0x0,
    next = 0x7f236c001f70
  },
  db_type = 0x5624d148c250,
  row_type = ROW_TYPE_DEFAULT,
  null_bits = 0,
  options = 0,
  merge_insert_method = 0,
  storage_media = HA_SM_DEFAULT,
  m_hidden = false,
  m_transactional_ddl = false,
  engine_attribute = {
    str = 0x0,
    length = 0
  },
  secondary_engine_attribute = {
    str = 0x0,
    length = 0
  },
  m_implicit_tablespace_autoextend_size = 0,
  m_implicit_tablespace_autoextend_size_change = true
}

```
### 查看 alter_info
```json
-exec p *pc2.alter_info
$117 = {
  drop_list = {
    <Mem_root_array_YY<Alter_drop const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  alter_list = {
    <Mem_root_array_YY<Alter_column const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  key_list = {
    <Mem_root_array_YY<Key_spec*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x7f236c003360,
      m_size = 2,
      m_capacity = 20
    }, <No data fields>},
  alter_rename_key_list = {
    <Mem_root_array_YY<Alter_rename_key const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  alter_index_visibility_list = {
    <Mem_root_array_YY<Alter_index_visibility const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  alter_constraint_enforcement_list = {
    <Mem_root_array_YY<Alter_constraint_enforcement const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  check_constraint_spec_list = {
    <Mem_root_array_YY<Sql_check_constraint_spec*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  create_list = {
    <base_list> = {
      first = 0x7f236c0034e8,
      last = 0x7f236cb3adc8,
      elements = 12
    }, <No data fields>},
  cf_appliers = std::vector of length 0, capacity 0,
  flags = 136,
  keys_onoff = Alter_info::LEAVE_AS_IS,
  partition_names = {
    <base_list> = {
      first = 0x5624ce192e30 <end_of_list>,
      last = 0x7f236c001e08,
      elements = 0
    }, <No data fields>},
  num_parts = 0,
  requested_algorithm = Alter_info::ALTER_TABLE_ALGORITHM_DEFAULT,
  requested_lock = Alter_info::ALTER_TABLE_LOCK_DEFAULT,
  with_validation = Alter_info::ALTER_VALIDATION_DEFAULT,
  new_db_name = {
    str = 0x0,
    length = 0
  },
  new_table_name = {
    str = 0x0,
    length = 0
  }
}
```
### 查看 key_create_info
```json
-exec p *pc2.key_create_info
$118 = {
  algorithm = HA_KEY_ALG_SE_SPECIFIC,
  is_algorithm_explicit = false,
  block_size = 0,
  parser_name = {
    str = 0x0,
    length = 0
  },
  comment = {
    str = 0x0,
    length = 0
  },
  is_visible = true,
  m_engine_attribute = {
    str = 0x5624cbc06860 "",
    length = 0
  },
  m_secondary_engine_attribute = {
    str = 0x5624cbc06860 "",
    length = 0
  }
}
```
### 查看 alter_info->key_list
```json
-exec p typeid(*pc2.alter_info->key_list->m_array[0]).__name
$126 = 0x5624cba4b508 <typeinfo name for Key_spec> "8Key_spec"

-exec p typeid(*pc2.alter_info->key_list->m_array[1]).__name
$127 = 0x5624cba4b508 <typeinfo name for Key_spec> "8Key_spec"
```
#### 查看 alter_info->key_list->m_array[0]
```json
-exec p *pc2.alter_info->key_list->m_array[0]
$129 = {
  _vptr.Key_spec = 0x5624cdc55540 <vtable for Key_spec+16>,
  type = KEYTYPE_PRIMARY,
  key_create_info = {
    algorithm = HA_KEY_ALG_SE_SPECIFIC,
    is_algorithm_explicit = false,
    block_size = 0,
    parser_name = {
      str = 0x0,
      length = 0
    },
    comment = {
      str = 0x0,
      length = 0
    },
    is_visible = true,
    m_engine_attribute = {
      str = 0x5624cbc06860 "",
      length = 0
    },
    m_secondary_engine_attribute = {
      str = 0x5624cbc06860 "",
      length = 0
    }
  },
  columns = {
    <Mem_root_array_YY<Key_part_spec*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x7f236c003358,
      m_size = 1,
      m_capacity = 1
    }, <No data fields>},
  name = {
    str = 0x0,
    length = 0
  },
  generated = false,
  check_for_duplicate_indexes = true
}
```

```json
-exec p *(pc2.alter_info->key_list->m_array[0]->columns->m_array[0])
$132 = {
  m_is_ascending = true,
  m_is_explicit = true,
  m_field_name = 0x7f236c18ca30 "id",
  m_prefix_length = 0,
  m_expression = 0x0,
  m_has_expression = false
}
```

#### 查看 alter_info->key_list->m_array[1]
```cpp
-exec p *pc2.alter_info->key_list->m_array[1]
$130 = {
  _vptr.Key_spec = 0x5624cdc55540 <vtable for Key_spec+16>,
  type = KEYTYPE_MULTIPLE,
  key_create_info = {
    algorithm = HA_KEY_ALG_SE_SPECIFIC,
    is_algorithm_explicit = false,
    block_size = 0,
    parser_name = {
      str = 0x0,
      length = 0
    },
    comment = {
      str = 0x0,
      length = 0
    },
    is_visible = true,
    m_engine_attribute = {
      str = 0x5624cbc06860 "",
      length = 0
    },
    m_secondary_engine_attribute = {
      str = 0x5624cbc06860 "",
      length = 0
    }
  },
  columns = {
    <Mem_root_array_YY<Key_part_spec*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x7f236cb3aeb0,
      m_size = 1,
      m_capacity = 1
    }, <No data fields>},
  name = {
    str = 0x7f236c0019c8 "idx_1",
    length = 5
  },
  generated = false,
  check_for_duplicate_indexes = true
}
```
### 查看 alter_info->create_list
#### begin
```json
-exec p *(Create_field*)((pc2.alter_info->create_list).begin().m_current.info)
$170 = {
  hidden = dd::Column::enum_hidden_type::HT_VISIBLE,
  field_name = 0x7f236c18ca30 "id",
  change = 0x0,
  after = 0x0,
  comment = {
    str = 0x7f236c18cbb8 "\345\224\257\344\270\200ID",
    length = 8
  },
  constant_default = 0x0,
  sql_type = MYSQL_TYPE_LONG,
  decimals = 0,
  flags = 515,
  auto_flags = 1 '\001',
  interval = 0x0,
  interval_list = {
    <base_list> = {
      first = 0x5624ce192e30 <end_of_list>,
      last = 0x7f236c003450,
      elements = 0
    }, <No data fields>},
  charset = 0x0,
  is_explicit_collation = false,
  geom_type = Field::GEOM_GEOMETRY,
  field = 0x0,
  offset = 2408550287,
  is_nullable = false,
  is_zerofill = false,
  is_unsigned = false,
  treat_bit_as_char = false,
  pack_length_override = 0,
  gcol_info = 0x0,
  stored_in_db = true,
  m_default_val_expr = 0x0,
  m_srid = std::optional<unsigned int> [no contained value],
  is_array = false,
  m_engine_attribute = {
    str = 0x5624cb2b0e20 "",
    length = 0
  },
  m_secondary_engine_attribute = {
    str = 0x5624cb2b0e20 "",
    length = 0
  },
  m_max_display_width_in_codepoints = 11,
  m_explicit_display_width = false
}
```
#### begin.next
```json
-exec p *(Create_field*)((pc2.alter_info->create_list).begin().m_current.next.info)
$171 = {
  hidden = dd::Column::enum_hidden_type::HT_VISIBLE,
  field_name = 0x7f236c18cdf0 "name",
  change = 0x0,
  after = 0x0,
  comment = {
    str = 0x7f236c18cf48 "\345\247\223\345\220\215",
    length = 6
  },
  constant_default = 0x0,
  sql_type = MYSQL_TYPE_VARCHAR,
  decimals = 0,
  flags = 4097,
  auto_flags = 0 '\000',
  interval = 0x0,
  interval_list = {
    <base_list> = {
      first = 0x5624ce192e30 <end_of_list>,
      last = 0x7f236c003970,
      elements = 0
    }, <No data fields>},
  charset = 0x0,
  is_explicit_collation = false,
  geom_type = Field::GEOM_GEOMETRY,
  field = 0x0,
  offset = 2408550287,
  is_nullable = false,
  is_zerofill = false,
  is_unsigned = false,
  treat_bit_as_char = false,
  pack_length_override = 0,
  gcol_info = 0x0,
  stored_in_db = true,
  m_default_val_expr = 0x0,
  m_srid = std::optional<unsigned int> [no contained value],
  is_array = false,
  m_engine_attribute = {
    str = 0x5624cb2b0e20 "",
    length = 0
  },
  m_secondary_engine_attribute = {
    str = 0x5624cb2b0e20 "",
    length = 0
  },
  m_max_display_width_in_codepoints = 255,
  m_explicit_display_width = true
}
```
#### begin.next.next
```json
-exec p *(Create_field*)((pc2.alter_info->create_list).begin().m_current.next.next.info)
$172 = {
  hidden = dd::Column::enum_hidden_type::HT_VISIBLE,
  field_name = 0x7f236c18d0c0 "salary",
  change = 0x0,
  after = 0x0,
  comment = {
    str = 0x7f236c18d140 "\350\226\252\350\265\204",
    length = 6
  },
  constant_default = 0x0,
  sql_type = MYSQL_TYPE_NEWDECIMAL,
  decimals = 2,
  flags = 0,
  auto_flags = 0 '\000',
  interval = 0x0,
  interval_list = {
    <base_list> = {
      first = 0x5624ce192e30 <end_of_list>,
      last = 0x7f236cb37ef0,
      elements = 0
    }, <No data fields>},
  charset = 0x0,
  is_explicit_collation = false,
  geom_type = Field::GEOM_GEOMETRY,
  field = 0x0,
  offset = 2408550287,
  is_nullable = true,
  is_zerofill = false,
  is_unsigned = false,
  treat_bit_as_char = false,
  pack_length_override = 0,
  gcol_info = 0x0,
  stored_in_db = true,
  m_default_val_expr = 0x0,
  m_srid = std::optional<unsigned int> [no contained value],
  is_array = false,
  m_engine_attribute = {
    str = 0x5624cb2b0e20 "",
    length = 0
  },
  m_secondary_engine_attribute = {
    str = 0x5624cb2b0e20 "",
    length = 0
  },
  m_max_display_width_in_codepoints = 12,
  m_explicit_display_width = true
}
```
# pc2 跟 PT_create_table_stmt、thd->lex 关系
```cpp
……
Table_ddl_parse_context pc2(thd, pc.select, &m_alter_info);
……
thd->lex->alter_info = &m_alter_info;
……
return new (thd->mem_root) Sql_cmd_create_table(&m_alter_info, qe_tables);
```

# 返回的 Sql_cmd_create_table 查看
## 断点位置
```cpp
bool LEX::make_sql_cmd(Parse_tree_root *parse_tree) {
  if (!will_contextualize) return false;

  m_sql_cmd = parse_tree->make_cmd(thd);
  if (m_sql_cmd == nullptr) return true;

  assert(m_sql_cmd->sql_command_code() == sql_command);

  return false;
}
```
## 对象内容
```json
-exec p *(Sql_cmd_create_table*)m_sql_cmd
$180 = {
  <Sql_cmd_ddl_table> = {
    <Sql_cmd_ddl> = {
      <Sql_cmd> = {
        _vptr.Sql_cmd = 0x5624cdd3ff68 <vtable for Sql_cmd_create_table+16>,
        m_owner = 0x0,
        m_part_of_sp = false,
        m_prepared = false,
        m_secondary_engine_enabled = true,
        m_prepared_with_optional_transform = false,
        m_secondary_engine = 0x0
      }, <No data fields>}, 
    members of Sql_cmd_ddl_table:
    m_alter_info = 0x7f236c001ce8
  }, 
  members of Sql_cmd_create_table:
  query_expression_tables = 0x0
}
```
## 查看  m_alter_info
```json
-exec p *(*(Sql_cmd_create_table*)m_sql_cmd)->m_alter_info
$183 = {
  drop_list = {
    <Mem_root_array_YY<Alter_drop const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  alter_list = {
    <Mem_root_array_YY<Alter_column const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  key_list = {
    <Mem_root_array_YY<Key_spec*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x7f236c003360,
      m_size = 2,
      m_capacity = 20
    }, <No data fields>},
  alter_rename_key_list = {
    <Mem_root_array_YY<Alter_rename_key const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  alter_index_visibility_list = {
    <Mem_root_array_YY<Alter_index_visibility const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  alter_constraint_enforcement_list = {
    <Mem_root_array_YY<Alter_constraint_enforcement const*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  check_constraint_spec_list = {
    <Mem_root_array_YY<Sql_check_constraint_spec*>> = {
      m_root = 0x7f236c1088b0,
      m_array = 0x0,
      m_size = 0,
      m_capacity = 0
    }, <No data fields>},
  create_list = {
    <base_list> = {
      first = 0x7f236c0034e8,
      last = 0x7f236cb3adc8,
      elements = 12
    }, <No data fields>},
  cf_appliers = std::vector of length 0, capacity 0,
  flags = 136,
  keys_onoff = Alter_info::LEAVE_AS_IS,
  partition_names = {
    <base_list> = {
      first = 0x5624ce192e30 <end_of_list>,
      last = 0x7f236c001e08,
      elements = 0
    }, <No data fields>},
  num_parts = 0,
  requested_algorithm = Alter_info::ALTER_TABLE_ALGORITHM_DEFAULT,
  requested_lock = Alter_info::ALTER_TABLE_LOCK_DEFAULT,
  with_validation = Alter_info::ALTER_VALIDATION_DEFAULT,
  new_db_name = {
    str = 0x0,
    length = 0
  },
  new_table_name = {
    str = 0x0,
    length = 0
  }
}
```

# 执行 SQL 跟踪
## mysql_execute_command
断点位置
```cpp
dispatch_sql_command(THD * thd, Parser_state * parser_state) (\data\mysql-server-8.2.0\sql\sql_parse.cc:5524)
dispatch_command(THD * thd, const COM_DATA * com_data, enum_server_command command) (\data\mysql-server-8.2.0\sql\sql_parse.cc:2137)
do_command(THD * thd) (\data\mysql-server-8.2.0\sql\sql_parse.cc:1466)
handle_connection(void * arg) (\data\mysql-server-8.2.0\sql\conn_handler\connection_handler_per_thread.cc:303)
pfs_spawn_thread(void * arg) (\data\mysql-server-8.2.0\storage\perfschema\pfs.cc:3049)
libc.so.6!start_thread(void * arg) (pthread_create.c:442)
libc.so.6!clone() (clone.S:100)
```
对应代码
```cpp
          const bool switched = mgr_ptr->switch_resource_group_if_needed(
              thd, &src_res_grp, &dest_res_grp, &ticket, &cur_ticket);

          error = mysql_execute_command(thd, true);

          if (switched)
            mgr_ptr->restore_original_resource_group(thd, src_res_grp,
```

## mysql_execute_command 函数内部
```cpp
    case SQLCOM_REPLACE:
    case SQLCOM_INSERT:
    case SQLCOM_REPLACE_SELECT:
    case SQLCOM_INSERT_SELECT:
    case SQLCOM_DELETE:
    case SQLCOM_DELETE_MULTI:
    case SQLCOM_UPDATE:
    case SQLCOM_UPDATE_MULTI:
    case SQLCOM_CREATE_TABLE:
    case SQLCOM_CREATE_INDEX:
    case SQLCOM_DROP_INDEX:
    case SQLCOM_ASSIGN_TO_KEYCACHE:
    case SQLCOM_PRELOAD_KEYS:
    case SQLCOM_LOAD: {
      assert(first_table == all_tables && first_table != nullptr);
      assert(lex->m_sql_cmd != nullptr);
      if (sql_check && thd->thread_id() > 1 && (lex->sql_command == SQLCOM_INSERT || lex->sql_command == SQLCOM_INSERT_SELECT ||
                                                lex->sql_command == SQLCOM_DELETE || lex->sql_command == SQLCOM_DELETE_MULTI ||
                                                lex->sql_command == SQLCOM_UPDATE || lex->sql_command == SQLCOM_UPDATE_MULTI)) {
        if (!sql_check_dml_allow_select || !sql_check_dml_allow_order || sql_check_dml_need_where) {
          check_sql_send_field_metadata(thd);
          check_sql_send_data(thd);
          my_eof(thd);
        }

      } else
        res = lex->m_sql_cmd->execute(thd);
      break;
    }
```

## 回到 Sql_cmd_create_table
```cpp
bool Sql_cmd_create_table::execute(THD *thd) {
    ……
    check_access
    ……
    res = mysql_create_table(thd, create_table, &create_info, &alter_info);
```

## 继续跟踪 mysql_create_table
```cpp
bool mysql_create_table(THD *thd, Table_ref *create_table,
                        HA_CREATE_INFO *create_info, Alter_info *alter_info) {
  ……
  handlerton *actual_hton = get_viable_handlerton_for_create(
      thd, create_table->table_name, *create_info);
  ……
  result = mysql_create_table_no_lock(
      thd, create_table->db, create_table->table_name, create_info, alter_info,
      0,
      /*
      We don't need to find parent keys for
      FK constraints if table exists.
      */
      !(create_table->table || create_table->is_view()), &is_trans,
      &post_ddl_ht);
  ……
```